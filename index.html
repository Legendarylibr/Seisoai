<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/1d1c7555360a737bb22bbdfc2784655f.png" />
    <link rel="shortcut icon" href="/1d1c7555360a737bb22bbdfc2784655f.png" />
    <link rel="apple-touch-icon" href="/1d1c7555360a737bb22bbdfc2784655f.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Seiso AI</title>
    
    <!-- Security Headers with proper CSP for development -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://js.stripe.com https://checkout.stripe.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https: blob:; connect-src 'self' http://localhost:3001 http://localhost:3000 http://localhost:5173 https://api.fal.ai https://api.mainnet-beta.solana.com https://solana-api.projectserum.com https://rpc.ankr.com https://solana-mainnet.g.alchemy.com https://mainnet.helius-rpc.com https://api.devnet.solana.com https: wss:; frame-src 'self' https://js.stripe.com https://checkout.stripe.com; object-src 'none'; base-uri 'self'; form-action 'self';" />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
    
    <!-- Enhanced wallet conflict resolution - must run first -->
    <script>
      (function() {
        'use strict';
        
        // Prevent multiple executions
        if (window.__walletConflictResolutionSetup) {
          return;
        }
        window.__walletConflictResolutionSetup = true;
        
        // Note: We no longer block evmAsk.js - we handle redefinition gracefully instead
        
        // Store original methods
        const originalDefineProperty = Object.defineProperty;
        const originalDefineProperties = Object.defineProperties;
        
        // GRACEFUL defineProperty override - silently handle redefinition attempts
        Object.defineProperty = function(obj, prop, descriptor) {
          // Handle ethereum property redefinition gracefully - ALWAYS prevent errors
          if (prop === 'ethereum' && obj === window) {
            // If ethereum already exists, NEVER try to redefine - just return it
            // This completely prevents errors from evmAsk.js and other wallet extensions
            if (window.ethereum) {
              // Always return existing ethereum object - never throw
              return window.ethereum;
            }
            
            // First definition - allow it, but catch any errors
            try {
              return originalDefineProperty.call(this, obj, prop, descriptor);
            } catch (error) {
              // If it fails for any reason, check if ethereum was set another way
              if (window.ethereum) {
                return window.ethereum;
              }
              // If still no ethereum, try with a more permissive descriptor
              try {
                const permissiveDescriptor = {
                  ...descriptor,
                  configurable: true,
                  enumerable: true,
                  writable: true
                };
                return originalDefineProperty.call(this, obj, prop, permissiveDescriptor);
              } catch (e2) {
                // Last resort: set it directly and return
                window.ethereum = descriptor.value || {};
                return window.ethereum;
              }
            }
          }
          
          // Prevent originalDefineProperty conflicts
          if (prop === 'originalDefineProperty' && obj === window) {
            if (window.originalDefineProperty) {
              console.warn('üõ°Ô∏è Wallet conflict prevented: originalDefineProperty already exists');
              return window.originalDefineProperty;
            }
          }
          
          // Prevent other common wallet conflicts
          if (prop === 'defineProperty' && obj === Object) {
            if (window.originalDefineProperty) {
              console.warn('üõ°Ô∏è Wallet conflict prevented: defineProperty already exists');
              return window.originalDefineProperty;
            }
          }
          
          try {
            return originalDefineProperty.call(this, obj, prop, descriptor);
          } catch (error) {
            // If it's a redefinition error, silently return the existing property
            if (error.message && (
                error.message.includes('Cannot redefine property') ||
                error.message.includes('Cannot define property') ||
                error.name === 'TypeError'
              )) {
              // Silently return existing property - no console warning
              if (obj[prop] !== undefined) {
                return obj[prop];
              }
              // If property doesn't exist but we got an error, try with permissive settings
              try {
                const permissiveDescriptor = {
                  ...descriptor,
                  configurable: true,
                  enumerable: true,
                  writable: true
                };
                return originalDefineProperty.call(this, obj, prop, permissiveDescriptor);
              } catch (e2) {
                // Final fallback: assign directly if possible
                if (descriptor.value !== undefined) {
                  obj[prop] = descriptor.value;
                  return obj;
                }
              }
            }
            // Only throw if it's not a redefinition error
            throw error;
          }
        };
        
        // Enhanced defineProperties override
        Object.defineProperties = function(obj, props) {
          if (obj === window && props.ethereum) {
            if (window.ethereum) {
              console.warn('üõ°Ô∏è Wallet conflict prevented: ethereum property already exists (defineProperties)');
              return window;
            }
          }
          return originalDefineProperties.call(this, obj, props);
        };
        
        // Store original functions
        window.originalDefineProperty = originalDefineProperty;
        window.originalDefineProperties = originalDefineProperties;
        
        // Handle uncaught errors - silently catch wallet redefinition errors
        window.addEventListener('error', function(event) {
          const error = event.error || event;
          const message = (error?.message || event.message || '').toString();
          const stack = (error?.stack || event.error?.stack || '').toString();
          const filename = (event.filename || '').toString();
          
          // Silently catch ALL ethereum property redefinition errors (harmless)
          if (message.includes('Cannot redefine property') && 
              (message.includes('ethereum') || filename.includes('evmAsk') || stack.includes('evmAsk'))) {
            event.preventDefault();
            event.stopPropagation();
            event.stopImmediatePropagation();
            // Silent - don't log to avoid console noise
            return false;
          }
          
          // Also catch any defineProperty errors from evmAsk.js
          if ((filename.includes('evmAsk') || stack.includes('evmAsk')) && 
              (message.includes('defineProperty') || message.includes('TypeError'))) {
            event.preventDefault();
            event.stopPropagation();
            event.stopImmediatePropagation();
            return false;
          }
        }, true); // Use capture phase to catch earlier
        
        // ULTRA-AGGRESSIVE: Override ALL error handling
        const originalOnError = window.onerror;
        const originalConsoleError = console.error;
        const originalConsoleWarn = console.warn;
        
        // Filter out harmless wallet redefinition errors from console
        console.error = function(...args) {
          const message = (args[0]?.toString?.() || '').toString();
          const fullMessage = args.map(a => a?.toString?.() || '').join(' ');
          
          // Filter ALL ethereum redefinition errors
          if (message.includes('Cannot redefine property') && 
              (message.includes('ethereum') || fullMessage.includes('evmAsk'))) {
            return; // Silent - these are harmless
          }
          
          // Filter defineProperty errors from evmAsk
          if ((message.includes('evmAsk') || fullMessage.includes('evmAsk')) && 
              (message.includes('defineProperty') || message.includes('TypeError'))) {
            return; // Silent
          }
          
          return originalConsoleError.apply(this, args);
        };
        
        // Filter out wallet conflict warnings
        console.warn = function(...args) {
          const message = (args[0]?.toString?.() || '').toString();
          
          // Filter ethereum redefinition warnings
          if (message.includes('Cannot redefine property') && message.includes('ethereum')) {
            return; // Silent
          }
          
          return originalConsoleWarn.apply(this, args);
        };
        
        // Override the global error handler - silently catch wallet redefinition errors
        window.onerror = function(message, source, lineno, colno, error) {
          const msgStr = (message || '').toString();
          const srcStr = (source || '').toString();
          const errMsg = (error?.message || '').toString();
          
          // Catch ALL variations of ethereum redefinition errors
          if (msgStr.includes('Cannot redefine property') && 
              (msgStr.includes('ethereum') || srcStr.includes('evmAsk') || errMsg.includes('ethereum'))) {
            return true; // Prevent default error handling
          }
          
          // Catch defineProperty errors from evmAsk
          if ((srcStr.includes('evmAsk') || errMsg.includes('evmAsk')) && 
              (msgStr.includes('defineProperty') || msgStr.includes('TypeError'))) {
            return true;
          }
          
          if (originalOnError) {
            return originalOnError.call(this, message, source, lineno, colno, error);
          }
          return false;
        };
        
        // Handle unhandled promise rejections - silently catch wallet redefinition errors
        window.addEventListener('unhandledrejection', function(event) {
          const reason = event.reason;
          const message = (reason?.message || '').toString();
          const stack = (reason?.stack || '').toString();
          
          // Silently prevent ALL wallet-related promise rejections from redefinition
          if ((message.includes('Cannot redefine property') && message.includes('ethereum')) ||
              (message.includes('evmAsk') && (message.includes('defineProperty') || message.includes('TypeError'))) ||
              (stack.includes('evmAsk') && message.includes('defineProperty'))) {
            event.preventDefault();
            event.stopPropagation();
            event.stopImmediatePropagation();
            // Silent - don't log
            return false;
          }
        }, true); // Use capture phase
        
        // Note: We no longer aggressively block script injection - we handle redefinition gracefully
        
        console.log('üõ°Ô∏è Enhanced wallet conflict resolution initialized');
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>