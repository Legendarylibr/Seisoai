openapi: 3.0.3
info:
  title: SeisoAI API
  description: |
    AI Image, Video, and Music Generation API with blockchain payment support.
    
    ## Authentication
    Most endpoints require authentication via JWT token or wallet address.
    
    ## Rate Limiting
    - General: 500 requests per 15 minutes
    - Auth: 10 attempts per 15 minutes
    - Free images: 5 per hour per IP
    
    ## Credits
    - 1 credit = $0.10
    - Image generation: 0.3-1.25 credits
    - Video generation: 2+ credits
    - Music generation: 0.25 credits/minute
  version: 1.0.0
  contact:
    name: SeisoAI Support
    url: https://seisoai.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://seisoai.com/api/v1
    description: Production server
  - url: http://localhost:3001/api/v1
    description: Development server

tags:
  - name: Health
    description: Health check endpoints
  - name: Auth
    description: Authentication endpoints
  - name: User
    description: User management
  - name: Generate
    description: AI generation endpoints
  - name: Gallery
    description: Gallery management
  - name: Payments
    description: Payment processing

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Returns server health status
      operationId: getHealth
      responses:
        '200':
          description: Server is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /version:
    get:
      tags:
        - Health
      summary: API version info
      description: Returns current API version and supported versions
      operationId: getVersion
      responses:
        '200':
          description: Version information
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  version:
                    type: string
                    example: "v1"
                  supportedVersions:
                    type: array
                    items:
                      type: string

  /auth/signup:
    post:
      tags:
        - Auth
      summary: Sign up with email
      description: Create a new account with email and password
      operationId: signUp
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 8
      responses:
        '201':
          description: Account created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/signin:
    post:
      tags:
        - Auth
      summary: Sign in with email
      description: Authenticate with email and password
      operationId: signIn
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /user/credits:
    get:
      tags:
        - User
      summary: Get user credits
      description: Get current credit balance for authenticated user
      operationId: getCredits
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Credit balance
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  credits:
                    type: number
                  totalCreditsEarned:
                    type: number
                  totalCreditsSpent:
                    type: number

  /generate/image:
    post:
      tags:
        - Generate
      summary: Generate image
      description: Generate an AI image from a text prompt
      operationId: generateImage
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - prompt
              properties:
                prompt:
                  type: string
                  maxLength: 2000
                  description: Text description of the image to generate
                style:
                  type: string
                  description: Optional style preset
                imageSize:
                  type: string
                  enum: [square, portrait, landscape]
                  default: square
                numImages:
                  type: integer
                  minimum: 1
                  maximum: 4
                  default: 1
                guidanceScale:
                  type: number
                  minimum: 1
                  maximum: 20
                  default: 7.5
      responses:
        '200':
          description: Image generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenerationResponse'
        '402':
          description: Insufficient credits
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /gallery:
    get:
      tags:
        - Gallery
      summary: Get user gallery
      description: Get all saved images for the authenticated user
      operationId: getGallery
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
      responses:
        '200':
          description: Gallery items
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  gallery:
                    type: array
                    items:
                      $ref: '#/components/schemas/GalleryItem'
                  total:
                    type: integer
                  page:
                    type: integer
                  pages:
                    type: integer

  /payments/verify:
    post:
      tags:
        - Payments
      summary: Verify blockchain payment
      description: Verify a blockchain transaction and add credits
      operationId: verifyPayment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - txHash
                - walletAddress
                - chainId
              properties:
                txHash:
                  type: string
                  description: Transaction hash
                walletAddress:
                  type: string
                  description: Sender wallet address
                chainId:
                  type: string
                  description: Blockchain chain ID
                tokenSymbol:
                  type: string
                  default: USDC
      responses:
        '200':
          description: Payment verified
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  credits:
                    type: number
                  totalCredits:
                    type: number
                  txHash:
                    type: string

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: healthy
        timestamp:
          type: string
          format: date-time
        uptime:
          type: integer
        environment:
          type: string
        database:
          type: string
          enum: [connected, disconnected]

    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
        token:
          type: string
        refreshToken:
          type: string
        user:
          $ref: '#/components/schemas/User'

    User:
      type: object
      properties:
        userId:
          type: string
        email:
          type: string
        walletAddress:
          type: string
        credits:
          type: number
        totalCreditsEarned:
          type: number
        totalCreditsSpent:
          type: number
        createdAt:
          type: string
          format: date-time

    GenerationResponse:
      type: object
      properties:
        success:
          type: boolean
        images:
          type: array
          items:
            type: string
            format: uri
        creditsUsed:
          type: number
        remainingCredits:
          type: number
        requestId:
          type: string

    GalleryItem:
      type: object
      properties:
        id:
          type: string
        imageUrl:
          type: string
          format: uri
        videoUrl:
          type: string
          format: uri
        prompt:
          type: string
        style:
          type: string
        creditsUsed:
          type: number
        timestamp:
          type: string
          format: date-time

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
        requestId:
          type: string

